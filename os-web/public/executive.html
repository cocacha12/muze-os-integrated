<!doctype html>
<html lang="es">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Muze Roadmap Executive</title>
<style>
:root{--bg:#0b0d10;--panel:#12161c;--panel2:#171c23;--line:#232a33;--text:#eef2f7;--muted:#95a1b3;--accent:#26CCC0}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 600px at 10% -10%,rgba(38,204,192,.1),transparent 40%),var(--bg);color:var(--text);font:14px/1.4 Inter,ui-sans-serif,system-ui}
.wrap{max-width:1180px;margin:0 auto;padding:24px}
.top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:14px}
.brand{display:flex;align-items:center;gap:12px}.brand img{height:28px}
.grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-bottom:14px}
.card{background:linear-gradient(180deg,var(--panel2),var(--panel));border:1px solid var(--line);border-radius:14px;padding:14px}
.k{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}.v{font-size:28px;font-weight:700;margin-top:6px}
.tbl{background:linear-gradient(180deg,var(--panel2),var(--panel));border:1px solid var(--line);border-radius:14px;overflow:hidden}
table{width:100%;border-collapse:collapse;font-size:13px}th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left}th{color:var(--muted);font-weight:600}
.pill{font-size:11px;padding:3px 7px;border-radius:999px;border:1px solid rgba(255,255,255,.18)}
.todo{color:#93c5fd}.in_progress{color:#fbbf24}.blocked{color:#fca5a5}.done{color:#86efac}
.link{color:var(--accent);text-decoration:none}
#auth{position:fixed;inset:0;background:rgba(0,0,0,.64);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:99}
#auth .panel{width:360px;background:linear-gradient(180deg,var(--panel2),var(--panel));border:1px solid #2a313c;border-radius:14px;padding:16px;display:grid;gap:10px}
input,button{width:100%;padding:10px 11px;border-radius:10px;border:1px solid #2a313c;background:#0f1319;color:var(--text)}
button{background:var(--accent);color:#052524;border:none;font-weight:700;cursor:pointer}
small{color:var(--muted)}
@media(max-width:980px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
</style>
</head>
<body>
<div id="auth"><div class="panel"><b>Login · Muze PM</b><input id="u" placeholder="usuario"/><input id="p" placeholder="password" type="password"/><button id="loginBtn">Entrar</button><small id="authMsg"></small></div></div>
<div class="wrap">
  <div class="top">
    <div class="brand"><svg viewBox="0 0 698 287" style="height:28px;width:auto" xmlns="http://www.w3.org/2000/svg" aria-label="Muze logo"><style>.s1{fill:#fff}.s2{fill:#26ccc0}</style><g><path class="s1" d="m23 48.5c0-14.8 11.7-26.5 26.5-26.5h5.8c11.3 0 19.2 5.8 24 13.7l64 104.1 64.2-104.4c1.8-2.8 5-7 10.3-10.3 10.7-6.7 21.9-5 25-4.4 4 1.7 9.8 5.1 12.6 11.3 4.6 10.3-1.7 22.6-5.7 28.7-44.4 67.4-76.7 116.1-83.5 127.8 0 0-6.7 11.6-15.7 14.6-3.9 1.3-7.9 1.3-7.9 1.3-9.7 0-16.5-5.1-22-13.4l-45.7-70.4v119.6c0 14.4-11.7 25.7-26.1 25.7-14.5 0-25.8-11.3-25.8-25.7z"/><path class="s2" d="m257 240.5c0-14-11.4-25.4-25.4-25.4-14 0-25.4 11.4-25.4 25.4 0 14.1 11.4 25.4 25.4 25.4 14 0 25.4-11.3 25.4-25.4z"/></g></svg><h1 style="margin:0">Muze Roadmap Executive</h1></div>
    <div><a class="link" href="/">Operations Desk</a> · <a class="link" href="/finance.html">Vista Finanzas</a></div>
  </div>
  <div class="card" style="margin-bottom:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <span class="k" style="margin:0">Filtro responsable</span>
    <select id="ownerFilter" style="max-width:280px;background:#0f1319;color:#fff;border:1px solid #2a313c;border-radius:10px;padding:8px 10px">
      <option value="">Todos</option>
    </select>
  </div>

  <div class="grid">
    <div class="card"><div class="k">Open</div><div id="openN" class="v">-</div></div>
    <div class="card"><div class="k">In Progress</div><div id="progN" class="v">-</div></div>
    <div class="card"><div class="k">Blocked</div><div id="blockN" class="v">-</div></div>
    <div class="card"><div class="k">Done</div><div id="doneN" class="v">-</div></div>
  </div>

  <div class="tbl">
    <table>
      <thead><tr><th>ID</th><th>Tarea</th><th>Owner</th><th>Due</th><th>Estado</th><th>Prioridad</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>
<script>
async function loadExec(){
 const me=await fetch('/api/me');
 if(!me.ok){ document.getElementById('auth').style.display='flex'; return; }
 document.getElementById('auth').style.display='none';
 const td=await (await fetch('/api/tasks',{cache:'no-store'})).json();
 const items=[...(td.tasks||[])].sort((a,b)=>String(a.dueDate||'9999').localeCompare(String(b.dueDate||'9999')));
 const counts={todo:0,in_progress:0,blocked:0,done:0};
 items.forEach(t=>counts[t.status]=(counts[t.status]||0)+1);
 openN.textContent=(counts.todo||0)+(counts.in_progress||0)+(counts.blocked||0);
 progN.textContent=counts.in_progress||0; blockN.textContent=counts.blocked||0; doneN.textContent=counts.done||0;
 const owners=[...new Set(items.map(t=>t.ownerId||'-'))].sort();
 ownerFilter.innerHTML='<option value="">Todos</option>'+owners.map(o=>`<option value="${o}">${o}</option>`).join('');
 const sel=ownerFilter.dataset.sel||''; if(sel) ownerFilter.value=sel;
 rows.innerHTML='';
 items.filter(t=>!ownerFilter.value || (t.ownerId||'-')===ownerFilter.value).slice(0,120).forEach(t=>{
   const tr=document.createElement('tr');
   tr.innerHTML=`<td>${t.id||''}</td><td>${t.title||''}</td><td>${t.ownerId||'-'}</td><td>${t.dueDate||'-'}</td><td><span class='pill ${t.status}'>${t.status||'todo'}</span></td><td>${t.priority||'media'}</td>`;
   rows.appendChild(tr);
 })
}
loginBtn.onclick=async()=>{
  authMsg.textContent='Entrando...';
  const r=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u.value,password:p.value})});
  if(!r.ok){authMsg.textContent='Credenciales inválidas'; return;}
  authMsg.textContent='OK';
  loadExec();
};
ownerFilter.onchange=()=>{ ownerFilter.dataset.sel=ownerFilter.value; loadExec(); };
loadExec();
</script>
</body>
</html>
